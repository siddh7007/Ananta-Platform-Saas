# ==============================================
# App Plane Environment Configuration
# ==============================================
# Copy this file to .env and fill in the values

# ==============================================
# Control Plane Integration
# ==============================================
# Webhook secret for secure communication between Control Plane and App Plane
# IMPORTANT: This MUST match APP_PLANE_WEBHOOK_SECRET in Control Plane's temporal-worker-service
WEBHOOK_SECRET=your-webhook-secret-change-me

# Control Plane API URL (for App Plane -> Control Plane calls)
CONTROL_PLANE_URL=http://localhost:14000
CONTROL_PLANE_API_KEY=your-control-plane-api-key

# ==============================================
# Webhook Bridge Configuration
# ==============================================
# Port for the webhook bridge service
WEBHOOK_BRIDGE_PORT=27600

# Supabase URL for the webhook bridge to connect to
SUPABASE_URL=http://supabase-kong:8000

# ==============================================
# Supabase (App Plane Database)
# ==============================================
# PostgreSQL Configuration
POSTGRES_USER=postgres
POSTGRES_DB=postgres
SUPABASE_DB_PASSWORD=postgres
SUPABASE_DB_PORT=27432
SUPABASE_API_PORT=27810
SUPABASE_STUDIO_PORT=27800
SUPABASE_JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long

# These keys are generated by Supabase - use 'openssl rand -base64 32' to generate
# For production: generate new keys using Supabase CLI or dashboard
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvY2FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE2MjUwOTIwMDAsImV4cCI6MTk0MDY2ODAwMH0.example
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvY2FsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTYyNTA5MjAwMCwiZXhwIjoxOTQwNjY4MDAwfQ.example

# ==============================================
# Django Backend (if using Components V2 pattern)
# ==============================================
DEBUG=False
DJANGO_SECRET_KEY=your-django-secret-key-change-me
DJANGO_BACKEND_PORT=27000

# ==============================================
# Keycloak Configuration (Shared with Control Plane)
# ==============================================
# The App Plane uses the same Keycloak instance as the Control Plane
# for centralized identity management
KEYCLOAK_URL=http://localhost:8180
KEYCLOAK_REALM=ananta-saas
KEYCLOAK_CLIENT_ID=app-plane-client

# Frontend Keycloak Configuration (used by React/Next.js portals)
VITE_KEYCLOAK_URL=http://localhost:8180
VITE_KEYCLOAK_REALM=ananta-saas
VITE_KEYCLOAK_CLIENT_ID=customer-portal
VITE_AUTH_PROVIDER=keycloak

# For enterprise tenants, separate realms may be created
# The webhook-bridge handles mapping tenant -> Keycloak realm

# ==============================================
# Auth0 Configuration (Alternative to Keycloak)
# ==============================================
# If using Auth0 instead of/alongside Keycloak:
# AUTH0_DOMAIN=your-tenant.auth0.com
# AUTH0_CLIENT_ID=your-client-id
# AUTH0_CLIENT_SECRET=your-client-secret
# AUTH0_API_AUDIENCE=https://api.your-domain.com

# ==============================================
# Novu (Notifications - shared with Control Plane)
# ==============================================
NOVU_ENABLED=true
NOVU_API_KEY=your-novu-api-key
NOVU_BACKEND_URL=http://localhost:13100

# ==============================================
# Frontend (Vite/React)
# ==============================================
VITE_API_URL=http://localhost:27000
VITE_SUPABASE_URL=http://localhost:27810
VITE_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
VITE_CNS_API_URL=http://localhost:27200
VITE_BACKEND_URL=http://localhost:27000

# Frontend Portal Ports
CUSTOMER_PORTAL_PORT=27100
BACKSTAGE_PORTAL_PORT=27150
CNS_DASHBOARD_PORT=27250
DASHBOARD_PORT=27400

# ==============================================
# Service Ports
# ==============================================
CNS_SERVICE_PORT=27200
MIDDLEWARE_API_PORT=27300

# ==============================================
# JWT Authentication (CNS Service)
# ==============================================
# Secret key for JWT token signing/verification
# Must be at least 32 characters for HS256 algorithm
JWT_SECRET_KEY=cns-jwt-secret-key-change-in-production-at-least-32-chars

# ==============================================
# CNS Service - AI Providers Configuration
# ==============================================
# Ollama (Local LLM - Primary, Free)
OLLAMA_ENABLED=true
OLLAMA_URL=http://ollama:11434
OLLAMA_MODEL=llama3:8b

# OpenAI (Optional - requires API key)
OPENAI_ENABLED=false
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4-turbo

# Claude (Optional - requires API key)
CLAUDE_ENABLED=false
CLAUDE_API_KEY=
CLAUDE_MODEL=claude-3-sonnet-20240229

# Perplexity (Optional - Web Search)
PERPLEXITY_ENABLED=false
PERPLEXITY_API_KEY=

# ==============================================
# CNS Service - Supplier API Configuration
# ==============================================
# Tier 1 Suppliers (Mouser, DigiKey, Element14)
# Set ENABLED=true and provide API keys to use each supplier
# If ENABLED=true but no API key provided, service will fail at startup

# Mouser Electronics
MOUSER_ENABLED=false
MOUSER_API_KEY=

# DigiKey (OAuth2 - requires client credentials)
DIGIKEY_ENABLED=false
DIGIKEY_CLIENT_ID=
DIGIKEY_CLIENT_SECRET=

# Element14 / Farnell / Newark
ELEMENT14_ENABLED=false
ELEMENT14_API_KEY=

# ==============================================
# CNS Service - Quality Thresholds
# ==============================================
QUALITY_REJECT_THRESHOLD=70
QUALITY_STAGING_THRESHOLD=94
QUALITY_AUTO_APPROVE_THRESHOLD=95

# ==============================================
# CNS Service - Feature Flags
# ==============================================
ENABLE_AI_SUGGESTIONS=true
ENABLE_WEB_SCRAPING=false
ENABLE_TIER2_SUPPLIERS=false
ENABLE_TIER3_OEM=false
ENABLE_MULTI_AI_FALLBACK=true
ENABLE_COST_TRACKING=true

# ==============================================
# CNS Service - Development/Testing
# ==============================================
# Set to true to use mock responses for testing without real API keys
MOCK_SUPPLIER_APIS=false
TEST_MODE=false

# ==============================================
# Shared Temporal Instance (Components V2)
# ==============================================
# The App Plane uses Components V2's Temporal instance
# This allows both Control Plane and App Plane to share workflows
TEMPORAL_ADDRESS=localhost:27020
TEMPORAL_NAMESPACE=default
TEMPORAL_TASK_QUEUE=enrichment

# ==============================================
# Plan Configuration
# ==============================================
# These should match the Control Plane's plan definitions
# Used by webhook-bridge to determine organization type and limits

# Plan ID -> Org Type mapping (set automatically by webhook-bridge)
# plan-basic     -> individual (5 users, 10K components, 10GB)
# plan-standard  -> team (25 users, 100K components, 100GB)
# plan-premium   -> enterprise (unlimited)

# ==============================================
# MinIO S3-Compatible Storage
# ==============================================
# S3-compatible object storage for BOM uploads, documents, exports
# Matches Component V2 reference architecture

# MinIO Server Configuration (uses MINIO_ROOT_* per official MinIO convention)
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_PORT=27040
MINIO_CONSOLE_PORT=27041

# MinIO CORS Configuration (for browser uploads)
MINIO_CORS_ALLOW_ORIGIN=http://localhost:27500

# S3 Bucket Names (auto-created on startup by minio-init)
S3_BUCKET_NAME=bom-uploads
S3_BUCKET_DOCUMENTS=documents
S3_BUCKET_EXPORTS=exports
S3_BUCKET_AVATARS=avatars
S3_BUCKET_AUDIT=enrichment-audit
S3_BUCKET_BULK=bulk-uploads

# MinIO URLs
# Internal endpoint (for docker services): minio:9000
# External endpoint (from host): http://localhost:27040
MINIO_INTERNAL_ENDPOINT=minio:9000
MINIO_ENDPOINT=http://localhost:27040
MINIO_EXTERNAL_URL=http://localhost:27040

# ==============================================
# Redis Configuration
# ==============================================
REDIS_PORT=27012

# ==============================================
# RabbitMQ Configuration
# ==============================================
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_MGMT_PORT=27673
RABBITMQ_USER=admin
RABBITMQ_PASSWORD=admin123

# ==============================================
# Components V2 Database (SSOT for Component Catalog)
# ==============================================
COMPONENTS_V2_DB_PORT=27010
COMPONENTS_V2_DB_USER=postgres
COMPONENTS_V2_DB_PASSWORD=postgres
COMPONENTS_V2_DB_NAME=components_v2

# ==============================================
# General
# ==============================================
FLASK_ENV=production
FLASK_DEBUG=false
LOG_LEVEL=INFO
NODE_ENV=development

# ==============================================
# Traefik Reverse Proxy
# ==============================================
# Centralized entry point for all App Plane services
# Handles CORS, routing, load balancing, and security headers
TRAEFIK_HTTP_PORT=27500
TRAEFIK_HTTPS_PORT=27443
TRAEFIK_DASHBOARD_PORT=27501

# ==============================================
# Network Configuration
# ==============================================
# For Docker networking with Control Plane
DOCKER_NETWORK=app-plane-network
