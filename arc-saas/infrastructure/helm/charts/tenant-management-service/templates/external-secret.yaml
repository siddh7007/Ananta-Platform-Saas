{{- if .Values.externalSecrets.enabled -}}
# =============================================================================
# External Secrets - Provider-Neutral Secret Injection
# =============================================================================
# Supports: AWS Secrets Manager, GCP Secret Manager, Azure Key Vault,
#           HashiCorp Vault, Oracle Vault
# =============================================================================

---
# Database Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "tenant-management-service.fullname" . }}-database
  labels:
    {{- include "tenant-management-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.secrets.database.existingSecret }}
    creationPolicy: Owner
  data:
    - secretKey: {{ .Values.secrets.database.keys.host }}
      remoteRef:
        key: arc-saas/database
        property: host
    - secretKey: {{ .Values.secrets.database.keys.port }}
      remoteRef:
        key: arc-saas/database
        property: port
    - secretKey: {{ .Values.secrets.database.keys.username }}
      remoteRef:
        key: arc-saas/database
        property: username
    - secretKey: {{ .Values.secrets.database.keys.password }}
      remoteRef:
        key: arc-saas/database
        property: password
    - secretKey: {{ .Values.secrets.database.keys.database }}
      remoteRef:
        key: arc-saas/database
        property: database

---
# Redis Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "tenant-management-service.fullname" . }}-redis
  labels:
    {{- include "tenant-management-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.secrets.redis.existingSecret }}
    creationPolicy: Owner
  data:
    - secretKey: {{ .Values.secrets.redis.keys.url }}
      remoteRef:
        key: arc-saas/redis
        property: url

---
# JWT Secret
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "tenant-management-service.fullname" . }}-jwt
  labels:
    {{- include "tenant-management-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.secrets.jwt.existingSecret }}
    creationPolicy: Owner
  data:
    - secretKey: {{ .Values.secrets.jwt.keys.secret }}
      remoteRef:
        key: arc-saas/jwt
        property: secret
    - secretKey: {{ .Values.secrets.jwt.keys.issuer }}
      remoteRef:
        key: arc-saas/jwt
        property: issuer

---
# Keycloak Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "tenant-management-service.fullname" . }}-keycloak
  labels:
    {{- include "tenant-management-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.secrets.keycloak.existingSecret }}
    creationPolicy: Owner
  data:
    - secretKey: {{ .Values.secrets.keycloak.keys.url }}
      remoteRef:
        key: arc-saas/keycloak
        property: url
    - secretKey: {{ .Values.secrets.keycloak.keys.realm }}
      remoteRef:
        key: arc-saas/keycloak
        property: realm
    - secretKey: {{ .Values.secrets.keycloak.keys.clientId }}
      remoteRef:
        key: arc-saas/keycloak
        property: clientId
    - secretKey: {{ .Values.secrets.keycloak.keys.clientSecret }}
      remoteRef:
        key: arc-saas/keycloak
        property: clientSecret

---
# Novu Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "tenant-management-service.fullname" . }}-novu
  labels:
    {{- include "tenant-management-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.secrets.novu.existingSecret }}
    creationPolicy: Owner
  data:
    - secretKey: {{ .Values.secrets.novu.keys.apiKey }}
      remoteRef:
        key: arc-saas/novu
        property: apiKey
    - secretKey: {{ .Values.secrets.novu.keys.appId }}
      remoteRef:
        key: arc-saas/novu
        property: appId

---
# Stripe Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "tenant-management-service.fullname" . }}-stripe
  labels:
    {{- include "tenant-management-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.secrets.stripe.existingSecret }}
    creationPolicy: Owner
  data:
    - secretKey: {{ .Values.secrets.stripe.keys.apiKey }}
      remoteRef:
        key: arc-saas/stripe
        property: apiKey
    - secretKey: {{ .Values.secrets.stripe.keys.webhookSecret }}
      remoteRef:
        key: arc-saas/stripe
        property: webhookSecret
{{- end }}
