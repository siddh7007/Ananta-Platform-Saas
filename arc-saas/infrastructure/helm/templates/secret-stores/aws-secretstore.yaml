# =============================================================================
# AWS Secrets Manager - ClusterSecretStore
# =============================================================================
# Prerequisites:
# 1. Install External Secrets Operator
# 2. Configure IRSA (IAM Roles for Service Accounts) or access keys
# 3. Create secrets in AWS Secrets Manager with path: arc-saas/<secret-name>
# =============================================================================
{{- if and .Values.global.secrets.provider (eq .Values.global.secrets.provider "external-secrets") }}
{{- if eq .Values.global.secrets.externalSecretsBackend "aws-secretsmanager" }}
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: arc-saas-secret-store
spec:
  provider:
    aws:
      service: SecretsManager
      region: {{ .Values.aws.region | default "us-east-1" }}
      {{- if .Values.aws.role }}
      # IRSA - Recommended for EKS
      role: {{ .Values.aws.role }}
      {{- end }}
      {{- if .Values.aws.accessKeySecret }}
      # Static credentials - NOT recommended for production
      auth:
        secretRef:
          accessKeyIDSecretRef:
            name: {{ .Values.aws.accessKeySecret }}
            key: access-key-id
            namespace: {{ .Values.aws.accessKeySecretNamespace | default "external-secrets" }}
          secretAccessKeySecretRef:
            name: {{ .Values.aws.accessKeySecret }}
            key: secret-access-key
            namespace: {{ .Values.aws.accessKeySecretNamespace | default "external-secrets" }}
      {{- end }}
{{- end }}
{{- end }}
